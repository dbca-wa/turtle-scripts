---
title: "Broome Season Review 2017-18"
author: "Marine Turtles WA, Sarah Mullineux, Florian Mayer"
date: "`r Sys.time()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    fig_width: 9
    fig_height: 5
---

```{r r setup, include=FALSE, message=FALSE, warning=FALSE}
source("tracks_setup.R")
source("tracks_helpers.R")
```

## Data

```{r filter_data}
source("load_data.R")
cbb <- tracks_all %>% filter_2017() %>% filter_broome()
cbb1 <- tracks_all %>% filter_2017() %>% filter_cbb1()
cbb2 <- tracks_all %>% filter_2017() %>% filter_cbb2()
cbb3 <- tracks_all %>% filter_2017() %>% filter_cbb3()
surveys_cbb <- surveys %>% filter_2017() %>% filter_broome_sites()
dist_cbb <- disturbance %>% filter_2017() %>% filter_broome_sites()
```

# Season summary

## Going digital
Entering and proofreading a record takes about 2 minutes with full concentration.
By going digital, data entry and proofreading are fully automated.
This season, the Cable Beach Volunteers have saved Sarah 
`r (nrow(cbb) + nrow(surveys_cbb)*2) * 2 / 60` hours of mind-numbing data entry
and proofreading work for `r nrow(cbb)` Track or Treats and 
`r nrow(surveys_cbb)*2` Site Visit Starts/Ends. 
This estimate excludes Fox Sakes and Marine Wildlife Incidents, about 2-3h extra!

## Maps
```{r map_overall}
cbb %>% add_nest_labels() %>% map_tracks()
```

## Nesting abundance
```{r tracks_all_sectors}
cbb %>% species_by_type() %>% kable()
```

## Sector 1
```{r tracks_sector_1}
cbb1 %>% species_by_type() %>% kable()
```

## Sector 2
```{r tracks_sector_2}
cbb2 %>% species_by_type() %>% kable()
```

## Sector 3
```{r tracks_sector_3}
cbb3 %>% species_by_type() %>% kable()
```

## Nesting success 

```{r nesting_success, fig.height=5, fig.width=7, warning = F}
cbb %>% tracks_ts()
cbb1 %>% tracks_ts()
cbb2 %>% tracks_ts()
cbb3 %>% tracks_ts()

nests <- cbb %>% track_success()
label <- "cbb"

nests %>% ggplot_track_success_by_date("natator-depressus", label)
nests %>% ggplot_track_success_by_date("chelonia-mydas", label)
nests %>% ggplot_track_successrate_by_date("natator-depressus", label)
nests %>% ggplot_track_successrate_by_date("chelonia-mydas", label)
nests %>% track_success_by_species() %>% datatable(.,
  caption = "Nesting success of fresh tracks (excl. nests without tracks and tagging)"
)
```

## Hatching and emergence success
```{r hatching_emergence_success}
cbb %>%
  hatching_emergence_success() %>%
  DT::datatable(.,
    caption = "Hatching and emergence success summary",
    options = list(paging = F)
  )
```

## Disturbance and predation
Disturbed nests are captured through form "Track or Treat" and appear here
as "tracks" with "disturbance" recorded as "present".

General signs of disturbance or predator presence are recorded through form 
"Fox Sake" and appear here as "dist_(place)".

### Disturbance and predation of nests
Turtle nests with recorded disturbance or predation.

```{r}
disturbed_nests_cbb <- cbb %>% filter(disturbance == "present")
disturbed_nests_cbb %>% add_nest_labels() %>% map_tracks()
```

There were **`r count(disturbed_nests_cbb)` reports** of disturbed nests. Caveat: QA to exclude possible training records.

Coming soon: details of disturbance to nests.

### General disturbance
There were **`r count(dist_cbb)` reports** of general disturbance or predator presence:

```{r}
dist_cbb %>% group_by(disturbance_cause) %>% tally %>% arrange(-n) %>% kable
dist_cbb %>% map_dist
```

## How many hatchlings were stuck in sand or dead the next morning?
No data

## Survey count
Q How many days of surveys across all sectors did we have out of 120 days monitoring period?

### Caveat
* Data includes training surveys.

This contributes to over-estimation of effort, but shows actual boots on the 
ground - training is also an effort!

```{r}
place <- "Cable Beach Broome"
surveys_cbb %>% plot_survey_count(place)
surveys_cbb %>% list_survey_count(place)
```

## Survey effort in hours
Q How many hours did volunteers survey, how many kilometers were walked?

### Caveat
* Surveys with missing end points are auto-closed after 5 hours. 
* Data includes training surveys.

Both factors contribute to over-estimation of effort.

```{r survey_effort}
surveys_cbb %>% plot_survey_effort(place)
surveys_cbb %>% list_survey_effort(place)
```

## Survey effort per person
Q Which volunteer did the most hours overall on survey?

### Caveat
Forgetting to enter one's name prior to a survey leads to incorrect attribution
of the survey effort to the previously entered volunteer's name.

```{r survey_effort_by_person}
personal_effort <- surveys_cbb %>% survey_hours_per_person()
personal_effort %>% kable()
```

## Survey effort in kilometers walked
Number of surveys per sector times length of sector.

In sector 1, `r survey_ground_covered(surveys_cbb, 22, 4)` km were walked 
in `r survey_count(surveys_cbb, 22)` surveys.

In sector 2, `r survey_ground_covered(surveys_cbb, 23, 4)` km were walked 
in `r survey_count(surveys_cbb, 23)` surveys.

In sector 3, `r survey_ground_covered(surveys_cbb, 24, 7)` km were walked 
in `r survey_count(surveys_cbb, 24)` surveys.

# Data upload

```{r data_upload}
# d <- ckanr::package_show("turtle-tracks")
ckanr::resource_update("9572e76b-55e9-4afb-b224-7cce7beb4959", "broome_2017-18.html")
```

